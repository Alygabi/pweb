!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="9d46c867-f200-36a9-9f4c-bd88ffa6231b")}catch(e){}}();
define(["exports","./c_watermarking_utils_getImageDefaultSizes","./c_api_v2_routes_password_confirmation_provider","./c_memoize-one","./c_init_data_debug_panel"],(function(e,t,s,r,n){"use strict";var o,i,a;e.ApiV2HeaderNames=void 0,(o=e.ApiV2HeaderNames||(e.ApiV2HeaderNames={})).DropboxApiArg="Dropbox-API-Arg",o.DropboxApiSelectAdmin="Dropbox-API-Select-Admin",o.DropboxPathRoot="X-Dropbox-Path-Root",o.DropboxUid="X-Dropbox-Uid",o.DropboxTeamId="X-Dropbox-Teamid",o.DropboxTeamAuthorization="X-Dropbox-Team-Authorization",o.CsrfToken="X-CSRF-Token",o.DropboxForceQuic="X-Dropbox-Force-Quic",function(e){e[e.TeamAdminRole=0]="TeamAdminRole",e[e.MTARole=1]="MTARole",e[e.FederationAdminRole=2]="FederationAdminRole"}(i||(i={})),function(e){e[e.AdminAction=0]="AdminAction",e[e.AssumeAction=1]="AssumeAction",e[e.OnBehalfOfAction=2]="OnBehalfOfAction"}(a||(a={}));class d{static parse(e){const t=e[".tag"];return 2===Object.keys(e).length&&null!=e[t]?new p(t,e[t]):new u(t,e)}constructor(e,t,s){this.type=e,this.value=t,this.isScalar=s}}class p extends d{constructor(e,t=null){super(e,t,!0)}toJSON(){const e={".tag":this.type};return null!=this.value&&(e[this.type]=this.value),e}}class u extends d{constructor(e,t={}){super(e,t,!1)}toJSON(){return{".tag":this.type,...this.value||{}}}}class c extends Error{static parseResponse(e,t,s,r,n,o=null){var i,a;null==o&&(o=e in g?g[e]:e>=500?m:c);const d={raw:{status:e,responseBody:s},response:null,summary:null,error:{},headers:t,rpcPath:r};let p=s;try{const e=JSON.parse(s)||{};d.error=e.error,d.summary=e.error_summary||(null===(a=null===(i=e.error)||void 0===i?void 0:i.status)||void 0===a?void 0:a[".tag"])||"",e.user_message&&"string"==typeof e.user_message.text?p=e.user_message.text:"string"==typeof d.summary&&""!==d.summary&&(p=`error_summary: "${d.summary}"`)}catch(e){}d.response=p,r&&!p.startsWith("Error in call to API function")&&(p=`Error in call to API function ${r}: ${p}`);const u=Object.assign(new o(p),d);return n&&(u.stack=n),u}}class l extends c{}class h extends c{}class m extends c{}class f extends c{}function _(e){return e instanceof c}const g={400:class extends c{},401:l,409:h,429:f};class w extends Error{constructor(e,t){super(t),this.name="FetchAbortError",this.response=e}}class b extends Error{constructor(e,t){super(t),this.name="FetchFailError",this.response=e}}class E extends Error{constructor(e,t){super(t),this.name="FetchResponseError",this.response=e}}function x(e){return"FetchResponseError"===e.name}const T={idleTimeout:500,networkTimeout:6e4};class A{constructor(){this.pendingRequests=0,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{this.didNetworkTimeOut=!0,this.pendingRequests=0,this.next("IDLE")}),T.networkTimeout)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.increment=()=>{this.startCleanupTimeout(),0===this.pendingRequests&&this.next("BUSY"),this.pendingRequests+=1},this.decrement=()=>{this.abortCleanupTimeout(),1===this.pendingRequests?this.next("IDLE"):this.startCleanupTimeout(),this.pendingRequests=Math.max(this.pendingRequests-1,0)},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}}}}class R{constructor(){this.pendingResources=new Set,this.subscribers=new Set,this.didNetworkTimeOut=!1,this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.startCleanupTimeout=()=>{this.abortCleanupTimeout();this.cleanupTimeout=window.setTimeout((()=>{this.didNetworkTimeOut=!0,this.pendingResources=new Set,this.next("IDLE")}),T.networkTimeout)},this.abortCleanupTimeout=()=>{window.clearTimeout(this.cleanupTimeout),this.cleanupTimeout=void 0},this.add=e=>{e instanceof HTMLImageElement&&!e.src||e instanceof HTMLImageElement&&e.complete||e instanceof HTMLLinkElement&&!e.href||e instanceof HTMLScriptElement&&!e.src||e instanceof HTMLIFrameElement&&!e.src||(this.startCleanupTimeout(),0===this.pendingResources.size&&this.next("BUSY"),this.pendingResources.add(e))},this.remove=e=>{this.abortCleanupTimeout(),this.pendingResources.delete(e),0===this.pendingResources.size?this.next("IDLE"):this.startCleanupTimeout()},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},(null===window||void 0===window?void 0:window.MutationObserver)&&window.addEventListener("load",(()=>{new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{e instanceof HTMLScriptElement||e instanceof HTMLLinkElement||e instanceof HTMLImageElement||e instanceof HTMLIFrameElement?this.add(e):e.hasChildNodes()&&e instanceof HTMLElement&&e.querySelectorAll("img").forEach(this.add)}))}))})).observe(window.document.documentElement,{childList:!0,subtree:!0}),["load","error"].forEach((e=>{window.document.addEventListener(e,(e=>{(e.target instanceof HTMLScriptElement||e.target instanceof HTMLLinkElement||e.target instanceof HTMLImageElement||e.target instanceof HTMLIFrameElement)&&this.remove(e.target)}),{capture:!0})}))}))}}class v{constructor(){this.incrementAjaxCount=()=>{},this.decrementAjaxCount=()=>{},this.isIdle=()=>!0,this.didNetworkTimeOut=()=>!1,this.resetDidNetworkTimeOut=()=>{},this.subscribe=()=>()=>{}}}class y{constructor(){this.ajaxIdleObservable=new A,this.resourceLoadingIdleObservable=new R,this.subscribers=new Set,this.ajaxIdle=!0,this.scriptLoadingIdle=!0,this.handleUpdate=e=>t=>{const s=this.ajaxIdle&&this.scriptLoadingIdle;"AJAX"===e&&(this.ajaxIdle="IDLE"===t),"RESOURCE_LOADING"===e&&(this.scriptLoadingIdle="IDLE"===t);const r=this.ajaxIdle&&this.scriptLoadingIdle;s!==r&&this.next(r?"IDLE":"BUSY")},this.next=e=>{this.subscribers.forEach((t=>t(e)))},this.incrementAjaxCount=()=>this.ajaxIdleObservable.increment(),this.decrementAjaxCount=()=>this.ajaxIdleObservable.decrement(),this.isIdle=()=>this.ajaxIdle&&this.scriptLoadingIdle,this.didNetworkTimeOut=()=>this.ajaxIdleObservable.didNetworkTimeOut||this.resourceLoadingIdleObservable.didNetworkTimeOut,this.resetDidNetworkTimeOut=()=>{this.ajaxIdleObservable.didNetworkTimeOut=!1,this.resourceLoadingIdleObservable.didNetworkTimeOut=!1},this.subscribe=e=>{this.subscribers.add(e);return()=>{this.subscribers.delete(e)}},this.ajaxIdleObservable.subscribe(this.handleUpdate("AJAX")),this.resourceLoadingIdleObservable.subscribe(this.handleUpdate("RESOURCE_LOADING"))}}let I;const k=()=>r.isServerSide()||"undefined"==typeof window?new v:(I||(I=new y),I),S=k().incrementAjaxCount,C=k().decrementAjaxCount;function O(e){const t={};return e.forEach(((e,s)=>{t[s]=e})),t}class H{executeRpc(e,t,r,n,o,i){return new Promise(((a,d)=>{s.incrementAjaxCount(),S();const p=()=>{s.decrementAjaxCount(),C()};return fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":n},body:r,signal:o}).then((e=>e.text().then((t=>({response:e,responseText:t}))))).then((({response:e,responseText:t})=>{if(e.ok)return{response:e,responseText:t};throw new E(e,t)})).then((({response:e,responseText:t})=>(p(),a({headers:O(e.headers),result:JSON.parse(t)})))).catch((t=>(p(),x(t)?d(c.parseResponse(t.response.status,O(t.response.headers),t.message,e.getPath(),i)):d(c.parseResponse(0,{},"Fetch network failure - message aborted or user offline",e.getPath(),i)))))}))}executeBinaryRpc(e,t,r,n,o){return new Promise(((i,a)=>(s.incrementAjaxCount(),S(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":n},body:r,signal:o}).then((e=>e.ok?e.arrayBuffer().then((t=>({response:e,responseData:t}))):e.text().then((t=>{throw new E(e,t)})))).then((({response:e,responseData:t})=>i({headers:O(e.headers),result:t}))).catch((t=>x(t)?a(c.parseResponse(t.response.status,O(t.response.headers),t.message,e.getPath())):a(c.parseResponse(0,{},"Fetch network failure - message aborted or user offline",e.getPath())))).finally((()=>{s.decrementAjaxCount(),C()})))))}}function L(){if(!window.ensemble)return void 0!==r.getYapsProject()&&void 0!==r.getYapsDeployment()?`${r.getYapsProject()}:${r.getYapsDeployment()}`:void 0;const e=window.ensemble.getPageletInfoForExceptionReporting().filter((e=>void 0!==e.yaps_deployment&&void 0!==e.yaps_project));return 0!==e.length?e.sort(((e,t)=>e.pagelet_name<t.pagelet_name?-1:1)).map((e=>`${e.yaps_project}:${e.yaps_deployment}`)).join(";"):void 0}class D extends H{}function j(e){const t=this,s=(new Error).stack;return{rpc:function(r,n,o){return t._rpc(e+"/"+r,n,o,s)},rpcWithResponseHeaders:function(r,n,o){return t._rpcWithResponseHeaders(e+"/"+r,n,o,s)},upload:function(s,r,n,o){return t._upload(e+"/"+s,r,n,o)},uploadWithResponseHeaders:function(s,r,n,o){return t._uploadWithResponseHeaders(e+"/"+s,r,n,o)},download:function(s,r,n,o){return t._download(e+"/"+s,r,n,o)},downloadWithResponseHeaders:function(s,r,n,o){return t._downloadWithResponseHeaders(e+"/"+s,r,n,o)}}}e.ApiError=c,e.ApiV2ClientBase=class{constructor(e,t=!1){this.uploadEndpoints=new Set(["backups/upload_session/append","files/alpha/upload","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","ungated_file_conv_block/convert_to_pdf"]),this.downloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/download_zip","files/export","files/get_preview","files/get_thumbnail_v2","paper/docs/download","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download","privacy_request/fs_user_get_export"]),this.supportedUploadEndpoints=new Set(["backups/upload_session/append","files/paper/create","files/paper/update","files/upload","files/upload_v2","files/upload_session/append_v2","files/upload_session/append_batch","files/upload_session/finish","files/upload_session/finish_v2","files/upload_session/start","paper/cloud_docs/update","paper/desktop/spaces/upload_log","paper/desktop/upload_log","paper/docs/create","paper/docs/update","support_attachments/upload","hellosign/self_sign","hellosign/send_signature_request","ungated_file_conv_block/convert_to_pdf"]),this.supportedDownloadEndpoints=new Set(["backups/download","backups/download_zip","files/download","files/get_thumbnail_v2","sharing/get_shared_link_file","sharing/export_shared_link","hellosign/convert_to_pdf_download","privacy_request/fs_user_get_export"]),this.transport=e||new D,this.ns=j.bind(this),this.skipCsrf=t}_upload(e,t,s,r){return this._uploadWithResponseHeaders(e,t,s,r).then((e=>e.result))}_uploadWithResponseHeaders(t,s,n,o){if(!this.uploadEndpoints.has(t))throw new Error(t+" does not use the content-upload endpoint format");if(!this.supportedUploadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-upload endpoints");const i={...this.csrfHeaders(),[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(s),...this._headers(o)};if(Boolean(r.isHTTP3SupportEnabled())&&(i[e.ApiV2HeaderNames.DropboxForceQuic]="true"),"string"==typeof n||void 0===n)return this.executeRpc(t,i,n||"","application/octet-stream",o.signal);{const e=new Blob([n],{type:"application/octet-stream"});return this.executeRpc(t,i,e,"application/octet-stream",o.signal)}}_download(e,t,s,r){return this._downloadWithResponseHeaders(e,t,s,r).then((e=>e.result))}_downloadWithResponseHeaders(t,s,n,o){if(void 0===o||!o.hasOwnProperty("dangerouslyFetchUserContent")||!o.dangerouslyFetchUserContent)throw new Error("download requires explicit acknowledgement of the risk");if(!this.downloadEndpoints.has(t))throw new Error(t+" does not use the content-download endpoint format");if(!this.supportedDownloadEndpoints.has(t))throw new Error(t+" is not in the supported list of content-download endpoints");const i={...this.csrfHeaders(),[e.ApiV2HeaderNames.DropboxApiArg]:this.http_header_safe_json(s),...this._headers(n)};return Boolean(r.isHTTP3SupportEnabled())&&(i[e.ApiV2HeaderNames.DropboxForceQuic]="true"),this.executeBinaryRpc(t,i,"","application/octet-stream",n.signal)}_rpc(e,t,s,r){return this._rpcWithResponseHeaders(e,t,s,r).then((e=>e.result))}_rpcWithResponseHeaders(t,s,n,o){const i={...this.csrfHeaders(),...this._headers(n)};if(Boolean(r.isHTTP3SupportEnabled())&&(i[e.ApiV2HeaderNames.DropboxForceQuic]="true"),this.downloadEndpoints.has(t))throw new Error(t+' does not use the rpc endpoint format. Use "download" instead');if(this.uploadEndpoints.has(t))throw new Error(t+' does not use the rpc endpoint format. Use "upload" instead');const a=JSON.stringify(s||null);return this.executeRpc(t,i,a,"application/json",n.signal,o)}csrfHeaders(){return this.skipCsrf||r.getPageAuthChannel()===r.AuthChannel.OAUTH_TOKEN?{}:{[e.ApiV2HeaderNames.CsrfToken]:n.mustReadCsrfToken()}}async executeRpc(e,s,r,o,i,a){const d=window.location.hostname===t.getDomains().CLIENT_WEB_WEBSERVER?t.getDomains().CLIENT_WEB_WEBSERVER:t.getDomains().WEBSERVER;const p=L();p&&(s["x-dropbox-client-yaps-attribution"]=p);const u=new n.URI({scheme:"https",authority:d,path:"/2/"+e,query:undefined});return await this.transport.executeRpc(u,s,r,o,i,a)}async executeBinaryRpc(e,s,r,o,i){const a=window.location.hostname===t.getDomains().CLIENT_WEB_WEBSERVER?t.getDomains().CLIENT_WEB_WEBSERVER:t.getDomains().WEBSERVER;const d=new n.URI({scheme:"https",authority:a,path:"/2/"+e,query:undefined});return await this.transport.executeBinaryRpc(d,s,r,o,i)}http_header_safe_json(e){return JSON.stringify(e).replace(/[\u007f-\uffff]/g,(function(e){return"\\u"+("000"+e.charCodeAt(0).toString(16)).slice(-4)}))}},e.AppError=h,e.CONFIG=T,e.FetchAbortError=w,e.FetchAsyncTransport=H,e.FetchFailError=b,e.FetchResponseError=E,e.FetchSyncTransport=class{executeRpc(e,t,r,n,o){return s.incrementAjaxCount(),S(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":n},keepalive:!0,body:r,signal:o}).finally((()=>{s.decrementAjaxCount(),C()})),Promise.resolve({headers:{},result:{}})}executeBinaryRpc(e,t,r,n,o){return s.incrementAjaxCount(),S(),fetch(e.toString(),{method:"POST",mode:"same-origin",credentials:"same-origin",headers:{...t,"Content-Type":n},keepalive:!0,body:r,signal:o}).finally((()=>{s.decrementAjaxCount(),C()})),Promise.resolve({headers:{},result:new ArrayBuffer(0)})}},e.RateLimitError=f,e.ServerError=m,e.Union=d,e.UnionScalar=p,e.catchApiError=function(e){return function(t){if(_(t))return e(t);throw t}},e.decrementAjaxCount=C,e.errorIsFetchAbortError=function(e){return"FetchAbortError"===e.name},e.errorIsFetchFailError=function(e){return"FetchFailError"===e.name},e.errorIsFetchResponseError=x,e.filterApiError=e=>e instanceof c?e:void 0,e.getAttributionHeader=L,e.getNetworkIdleObservable=k,e.incrementAjaxCount=S,e.isApiError=_,e.isAppError=function(e){return e instanceof h},e.isAuthError=function(e){return e instanceof l},e.isRateLimitError=function(e){return e instanceof f},e.isServerError=function(e){return e instanceof m}}));
//# sourceMappingURL=c_api_v2_client_base.js-vfli38oym.map

//# debugId=9d46c867-f200-36a9-9f4c-bd88ffa6231b