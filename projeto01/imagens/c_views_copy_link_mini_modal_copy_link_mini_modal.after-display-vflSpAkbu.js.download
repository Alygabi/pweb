!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="02c2f460-9c2b-3fb5-90ef-60381da3e43b")}catch(e){}}();
define(["exports","react","./c_browser_browser_detection","./e_data_modules_stormcrow","./e_file_viewer_static_scl_page_file","./c_ui_share-blocking-wrapper_share_blocking_wrapper","./c_shared_with_redux_store","./c_core_i18n","./c_init_data_debug_panel","./c_memoize-one","./c_maestro_nav_shared_code_dropbox_logo","./c_dig-icons_assets_ui-icon_line_upload","./c_lodash-es_lodash","./c_init_data_edison","./c_react-use_misc_util","./c_src_sink_index","./e_core_exception","./e_edison","./c_api_v2_routes_password_confirmation_provider","./c_pap-events_navigation_select_create_folder_action","./c_api_v2_client_base","./c_watermarking_utils_getImageDefaultSizes","./c_core_notify","react-dom","./c_security_csrf_hmac","./c_upload_kit_lib_types","./c_base64","./c_browse_shared_with_api","./c_sharing_avatar_info","metaserver/static/js/langpack"],(function(e,t,i,s,n,o,a,r,l,c,d,p,h,u,_,g,m,f,E,L,C,I,S,k,T,A,y,O,v,M){"use strict";function N(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var R=N(t);n.injectInternalStyle("/static/metaserver/static/js/sharing/views/copy_link_mini_modal/copy_link_mini_modal.module.out-vflmpabqn.css",(e=>"._centered-copy-link-mini-modal_1achy_2{background-color:var(--dig-color__background__subtle);border-radius:var(--dig-radius__xlarge);padding:12px}._centered-modal-body_1achy_8{padding:0}._centered-pending-screen_1achy_13{row-gap:var(--dig-spacing__micro__medium)}._centered-error-screen_1achy_23,._centered-pending-screen_1achy_13{align-items:center;display:flex;flex-direction:column;height:133px;justify-content:center}._centered-error-screen_1achy_23{row-gap:var(--dig-spacing__micro__small)}._centered-error-screen-text_1achy_32{align-items:center;display:flex;flex-direction:column;text-align:center;width:80%}._centered-error-screen-title-text_1achy_40{align-items:center;display:flex;flex-direction:column;margin-bottom:0}._centered-header-section_1achy_48{align-items:center;display:flex;padding:0}._centered-header-section-text-container_1achy_55{line-height:18px;max-width:280px;width:100%}._centered-header-section-primary-text_1achy_61{font-family:var(--dig-type__family__title)}._centered-link-container_1achy_66{background-color:var(--dig-color__background__base)}._link-copied-badge_1achy_70{text-wrap:nowrap;align-items:center;background-color:var(--dig-color__success__surface--state-1);border-radius:var(--dig-radius__small);color:var(--dig-color__success__base);display:flex;font-family:var(--dig-type__family__action);font-size:var(--dig-type__size__action__small);letter-spacing:var(--dig-type__letterspacing__action);margin-right:calc(var(--dig-spacing__micro__xsmall)*-1);padding-left:var(--dig-spacing__micro__small);padding-right:var(--dig-spacing__micro__small);white-space:nowrap;width:fit-content}._link-copied-badge-checkmark_1achy_90{padding-right:var(--dig-spacing__micro__xsmall)}._link-accessory-button_1achy_94{margin-right:calc(var(--dig-spacing__micro__xsmall)*-1)}"));const b="_centered-copy-link-mini-modal_1achy_2",P="_centered-modal-body_1achy_8",w="_centered-header-section_1achy_48",x="_link-accessory-button_1achy_94",F=()=>{const[e,t]=R.useState(!0);if(!e)return null;const i=r.intl.formatMessage({id:"FABv5W",defaultMessage:"Recipients can comment on your files without a Dropbox account."});return R.createElement(n.Box,{borderRadius:"Large",backgroundColor:"Primary Surface",padding:"Micro Medium",marginTop:"Micro Medium",style:{display:"flex",justifyContent:"space-between"}},R.createElement(n.Text,{variant:"paragraph",size:"medium"},i,R.createElement(n.Link,{href:"https://help.dropbox.com/view-edit/turn-off-comment-feature",variant:"monochromatic",isBold:!0,style:{marginLeft:"var(--dig-spacing__micro__xsmall)"},target:"_blank"},r.intl.formatMessage({id:"onr7U5",defaultMessage:"Learn more"}))),R.createElement(n.IconButton,{variant:"transparent",size:"small",onClick:()=>t(!1)},R.createElement(n.UIIcon,{src:n.CloseLine,"aria-label":r.intl.formatMessage({id:"+qEQdA",defaultMessage:"Close"})})))};F.displayName="LoggedOutCommentingBanner";const D="copy-link-mini-modal__footer";class U extends R.Component{constructor(){super(...arguments),this.handleManageClick=()=>{n.ShareTibEventLogger.log(this.props.user.id,n.TiburonEventName.ClickManageLinkSettings,n.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL,{...n.buildExtraFromLinkMetadata(this.props.sharedLink),fq_path:this.getFqPath()}),this.props.openShareModalSettings(n.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_MINI_MODAL)}}render(){return R.createElement("div",{className:D},R.createElement("div",{className:`${D}-content`},this._renderLinkInfo(),!n.isShortcutFileType(this.getFqPath())&&this._renderManageButton()))}_renderLinkInfo(){return R.createElement(n.Text,{"data-testid":"link-info",style:{display:"flex",alignItems:"flex-start"},color:"subtle",size:"small"},this.renderAudienceIcon(),this.formatLinkInfoText())}_renderManageButton(){return R.createElement(n.Button,{variant:"transparent",size:"small",style:{marginLeft:"8px",alignSelf:"flex-start",paddingTop:"2px"},onClick:this.handleManageClick},r.intl.formatMessage({id:"6BOuuN",defaultMessage:"Manage"}))}getFqPath(){let e;return this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path),e}formatLinkInfoText(){return this.props.contentType?"public"===this.props.linkAudience?r.intl.formatMessage({id:"8kew9O",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"team"===this.props.linkAudience?r.intl.formatMessage({id:"LlzMnS",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"password"===this.props.linkAudience?r.intl.formatMessage({id:"2yevNp",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"no_one"===this.props.linkAudience?r.intl.formatMessage({id:"iv/o3s",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}} the {isFolder, select, true {folder} other {file}}"},{canEdit:"editor"===this.props.linkAccessLevel,isFolder:"folder"===this.props.contentType}):"":"public"===this.props.linkAudience?r.intl.formatMessage({id:"5n50wF",defaultMessage:"Anyone with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"team"===this.props.linkAudience?r.intl.formatMessage({id:"HcnRtr",defaultMessage:"Team members with this link can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"password"===this.props.linkAudience?r.intl.formatMessage({id:"ego60b",defaultMessage:"People with the password can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):"no_one"===this.props.linkAudience?r.intl.formatMessage({id:"VUeAlW",defaultMessage:"Only people invited can {canEdit, select, true {edit} other {view}}"},{canEdit:"editor"===this.props.linkAccessLevel}):""}renderAudienceIcon(){let e=null;return"public"===this.props.linkAudience?e=n.GlobeLine:"team"===this.props.linkAudience?e=d.TeamLine:"no_one"===this.props.linkAudience?e=d.LockLine:"password"===this.props.linkAudience&&(e=p.PasswordsLine),null===e?null:R.createElement(n.UIIcon,{"data-testid":"audience-icon",src:e,size:"small",style:{marginRight:"4px",paddingTop:"4px"}})}}U.displayName="CopyLinkMiniModalFooterComponent";const B=n.requireCssWithComponent(U,["/static/metaserver/static/css/dig-components/index.web-vflwzEcep.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css"]);class H extends R.Component{render(){return this.renderCenteredHeader()}getContentName(){let e;if(this.props.fileInfo?e=this.props.fileInfo.fq_path:this.props.fileUploadInfo?e=this.props.fileUploadInfo.dest+"/"+this.props.fileUploadInfo.name:this.props.browseFileInfo&&(e=this.props.browseFileInfo.fq_path),e){const t=e.split("/");return t[t.length-1]}}renderCenteredHeader(){let e;if(this.props.isTriggeredAsShareModal)e=this.getContentName();else if(this.props.stageType===n.ModalStage.COPY)e=r.intl.formatMessage({id:"UBFgfk",defaultMessage:"Copy link to"});else if(this.props.stageType===n.ModalStage.RESULT)e=(e=>e.formatMessage({id:"Og6X3p",defaultMessage:"Link copied to"}))(r.intl);else{if(this.props.stageType!==n.ModalStage.ERROR_CLIENT)return null;e=((e,t)=>t?e.formatMessage({id:"fLNxZU",defaultMessage:"Couldn’t copy link to comment"}):e.formatMessage({id:"pTCiXO",defaultMessage:"Couldn’t copy link to"}))(r.intl,this.props.isLinkToComment)}const t=!this.props.isTriggeredAsShareModal&&R.createElement(R.Fragment,null,R.createElement(n.Text,{size:"small",color:"subtle"},R.createElement(n.Truncate,{location:.5},this.getContentName())));return R.createElement("div",{className:"_centered-header-section-text-container_1achy_55","data-testid":"clmm-header"},R.createElement(n.Text,{size:"medium",isBold:!0,className:"_centered-header-section-primary-text_1achy_61"},R.createElement(n.Truncate,{location:.5},e)),t)}}H.displayName="CopyLinkMiniModalHeaderComponent";const V=n.requireCssWithComponent(H,["/static/metaserver/static/css/dig-components/index.web-vflwzEcep.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css"]);class W extends R.Component{constructor(){super(...arguments),this.handleCopy=()=>{this.props.onCopyToClipboard(n.CopyLinkMethod.MANUAL)},this.renderRightAccessory=()=>this.props.stage===n.ModalStage.RESULT?R.createElement(n.Text,{className:"_link-copied-badge_1achy_70",isBold:!0},R.createElement(n.UIIcon,{src:n.CheckmarkLine,className:"_link-copied-badge-checkmark_1achy_90"}),r.intl.formatMessage({id:"zGjUch",defaultMessage:"Link copied"})):this.props.stage===n.ModalStage.COPY?R.createElement(n.Button,{className:x,variant:"primary",size:"small",onClick:()=>{var e,t;return null===(t=(e=this.props).onClickCopyLink)||void 0===t?void 0:t.call(e,!0)}},(e=>e.formatMessage({id:"4nKHfq",defaultMessage:"Copy link"}))(r.intl)):this.props.stage===n.ModalStage.ERROR_CLIENT?R.createElement(n.Button,{className:x,variant:"primary",size:"small",onClick:()=>{var e,t;return null===(t=(e=this.props).onClickCopyLink)||void 0===t?void 0:t.call(e,!0)}},(e=>e.formatMessage({id:"d5v7fB",defaultMessage:"Try again"}))(r.intl)):null}componentDidMount(){this.props.shouldFocusOnLink&&this.props.focusOnInput()}render(){return R.createElement("div",{className:"copy-link-mini-modal__link"},R.createElement(n.TextInput,{onCopy:this.handleCopy,size:"large","aria-label":r.intl.formatMessage({id:"qx4buj",defaultMessage:"Link for copy link click"}),value:this.props.sharedLink.url,readOnly:!0,onClick:this.props.focusOnInput,ref:this.props.inputRef,wrapperProps:{className:n.cx("link-container","_centered-link-container_1achy_66")},withRightAccessory:this.renderRightAccessory()}))}}W.displayName="CopyLinkMiniModalLinkComponent";const q=n.requireCssWithComponent(W,["/static/metaserver/static/css/dig-components/index.web-vflwzEcep.css","/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css"]);class Y extends R.default.Component{constructor(e){super(e),this.onWindowResize=h.throttle((()=>{this.props.isCenteredDisplayed||this.props.anchorRef.current||this.props.closeButtonHandler()}),500),this.handleClick=e=>{e.stopPropagation()},this.overlayRef=R.default.createRef(),this.tabRef=R.default.createRef(),this.state={tabIndex:0}}componentDidMount(){window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize)}componentDidUpdate(){var e;null===(e=this.overlayRef.current)||void 0===e||e.update()}render(){const{inputRef:e,stage:t,closeButtonHandler:i,linkAccessLevel:s,sharedLink:o,shouldFocusOnLink:a,focusOnInput:l,actionHandler:c,onCopyToClipboard:d,zIndexOverride:p,fileInfo:h,fileUploadInfo:u,browseFileInfo:_,linkAudience:g,user:m,isLoggedOutCommentingEnabled:f,openShareModalSettings:E,isLinkToComment:L,isTriggeredAsShareModal:C}=this.props,I=R.default.createElement(V,{stageType:t,isLinkToComment:L,fileInfo:h,fileUploadInfo:u,browseFileInfo:_,isTriggeredAsShareModal:C});let S=R.default.createElement(R.default.Fragment,null);o&&l&&e&&(S=R.default.createElement(q,{sharedLink:o,focusOnInput:l,inputRef:e,onClickCopyLink:c,shouldFocusOnLink:a,onCopyToClipboard:d,stage:t}));let k=R.default.createElement(R.default.Fragment,null);if(o&&!C&&(t===n.ModalStage.RESULT||t===n.ModalStage.COPY||t===n.ModalStage.ERROR_CLIENT)){let e;"object"==typeof o&&".tag"in o&&(e=o[".tag"]),e||(e=o.file_type),k=R.default.createElement(B,{linkAccessLevel:s,linkAudience:g,contentType:e,fileInfo:h,fileUploadInfo:u,browseFileInfo:_,user:m,sharedLink:o,openShareModalSettings:E})}if(this.props.isCenteredDisplayed)return R.default.createElement(n.Modal$1,{open:!0,isCentered:!0,width:442,onRequestClose:t===n.ModalStage.PENDING?void 0:i,withCloseButton:(T=r.intl,T.formatMessage({id:"QKIeC9",defaultMessage:"Close"})),closeButtonProps:{disabled:t===n.ModalStage.PENDING}},R.default.createElement("div",{className:b},R.default.createElement(n.Modal$1.Header,{className:w},I),R.default.createElement(n.Modal$1.Body,{className:P},this.renderCenteredPendingScreen(),this.renderCenteredErrorScreen(),S,k,f&&R.default.createElement(F,null))));var T;const A=R.default.createElement(n.IconButton,{"aria-label":"close","data-testid":"clmm-close-button",onClick:i,variant:"transparent",style:{position:"absolute",top:"8px",right:"8px"},disabled:t===n.ModalStage.PENDING},R.default.createElement(n.UIIcon,{src:n.CloseLine,"aria-label":""}));return R.default.createElement(n.LayerContext.Provider,{value:{zIndex:p||20}},R.default.createElement(n.ClickOutside,{isActive:!0,onClickOutside:t===n.ModalStage.PENDING?void 0:i,shouldPropagateMouseEvents:!1,isBlock:!0,shouldClickOutsideWhenDefaultPrevented:!0},R.default.createElement(n.Overlay,{className:"copy-link-mini-modal__overlay",anchorRef:this.props.anchorRef,placement:this.props.placement||"bottom",auto:!0,offsetDistance:null!=this.props.yOffsetDistance?this.props.yOffsetDistance:4,onClick:this.handleClick,ref:this.overlayRef,style:{width:442,padding:0},onKeyDown:e=>{if(this.overlayRef.current){if("Escape"===e.key)return this.props.closeButtonHandler(),e.preventDefault(),void e.nativeEvent.stopImmediatePropagation();if("Tab"===e.key){if(!this.tabRef||!this.tabRef.current)return;e.preventDefault();const t=this.tabRef.current.querySelectorAll('button:not([disabled]), [href]:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"]):not([disabled])');let i,s=this.state.tabIndex;for(let e=0;e<t.length;e++){if(t[e]===document.activeElement){s=e;break}}i=e.shiftKey?(s-1+t.length)%t.length:(s+1)%t.length,t[i].focus(),this.setState({tabIndex:i})}}}},R.default.createElement("div",{className:b,ref:this.tabRef},A,R.default.createElement(n.Modal$1.Header,{className:w},I),R.default.createElement(n.Modal$1.Body,{className:P},this.renderCenteredPendingScreen(),this.renderCenteredErrorScreen(),S,k,f&&R.default.createElement(F,null))))))}renderCenteredPendingScreen(){return this.props.stage===n.ModalStage.PENDING?R.default.createElement(n.Box,{className:"_centered-pending-screen_1achy_13"},R.default.createElement(n.Spinner,null),R.default.createElement(n.Text,{color:"subtle"},r.intl.formatMessage({id:"Fd4Wq1",defaultMessage:"Getting the link"}))):null}renderCenteredErrorScreen(){return this.props.stage===n.ModalStage.ERROR_SERVER?R.default.createElement(n.Box,{className:"_centered-error-screen_1achy_23"},R.default.createElement(n.UIIcon,{src:n.FailPictogram,size:"large"}),R.default.createElement(n.Box,{className:"_centered-error-screen-text_1achy_32"},R.default.createElement(n.Title,{className:"_centered-error-screen-title-text_1achy_40",weightVariant:"emphasized",size:"small"},r.intl.formatMessage({id:"TffHle",defaultMessage:"Couldn’t copy link"})),R.default.createElement(n.Text,{color:"subtle"},this.props.errorMessage))):null}}Y.displayName="CopyLinkMiniModalOverlayComponent";const G=n.requireCssWithComponent(Y,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css","/static/metaserver/static/css/dig-components/index.web-vflwzEcep.css"]);class K extends R.default.Component{constructor(e){super(e),this.logPAPAsShareModal=e=>{var t,i;const s=this.loggingKey,o="start"===e.loggingAction?n.UDCL.logStart:n.UDCL.logEnd,a="end"===e.loggingAction?e.eventState:void 0,r={actionElement:this.actionElement,actionSurface:null!==(t=this.actionSurface)&&void 0!==t?t:"unknown",isDir:"false",screen:null!==(i=this.screen)&&void 0!==i?i:"unknown"};o("ops.sm24.browse_load",{tags:r,key:s,eventState:a}),o(n.PAP_Load_ShareModal({eventState:a,actionElement:this.actionElement,actionSurface:this.actionSurface,contentAction:"share",sharedObjType:"file",fileExtension:this.props.file?n.getExtension(this.props.file):"",isDir:!1,screen:this.screen}),{tags:r,key:s})},this.getScreen=()=>this.props.isTriggeredAsShareModal?"pointer_modal_screen":this.props.isFromShareMe24Modal?"share_screen":void 0,this.getPAPLoggerContent=()=>this.props.file?n.getContentFromFile(this.props.file):this.props.browseFile?n.getContentFromFile(this.props.browseFile):this.props.fileUpload?n.getContentFromFileUpload(this.props.fileUpload):void 0,this.appendSenderTrackeyToLink=()=>{var e;this.sharedLink&&this.sharedLink.url&&!n.isShortcutFileType(null===(e=this.props.file)||void 0===e?void 0:e.fq_path)&&(this.sharedLink=n.getNewLinkMetadataWithSenderTrackeyURL(this.sharedLink,this.senderTrackey))},this.appendCommentIdToLink=()=>{this.sharedLink&&this.sharedLink.url&&this.props.commentId&&(this.sharedLink=n.getNewLinkMetadataWithUrlFragment(this.sharedLink,"comment_id="+this.props.commentId))},this.handleClipboardWriterCopyLinkToClipboard=()=>{var e;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),null===(e=this.props.clipboardWriter)||void 0===e||e.write(this.sharedLink.url),this.handleClipboardSuccess(n.CopyLinkMethod.CLIPBOARD_API)},this.handleCopyLinkToClipboard=(e=!1)=>{e&&n.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.appendSenderTrackeyToLink(),this.appendCommentIdToLink(),n.copyToClipboard(this.sharedLink.url,(()=>{this.handleClipboardSuccess(n.CopyLinkMethod.EXEC_COMMAND)}),this.handleClipboardFailure)},this.handleClipboardSuccess=e=>{e!==n.CopyLinkMethod.MANUAL&&(this.setState({stage:n.ModalState.RESULT}),this.focusOnInput(),setTimeout((()=>{this.setState({stage:n.ModalState.COPY})}),5e3)),this.logEvent(n.TiburonEventName.CopySharedLink,{created_new_link:this.isLinkNewlyCreated,copy_method:e,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCopyLinkTime),sender_trackey:this.senderTrackey,commentId:this.props.commentId}),n.logPAPCopySharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})},this.handleOnCopyToClipboard=e=>{n.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:this.sharedLink,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.handleClipboardSuccess(e)},this.handleClipboardFailure=()=>{this.copyLinkToClipboardNewAPI()},this.copyLinkToClipboardNewAPI=()=>{if(navigator.clipboard){const e=this.sharedLink.url;navigator.clipboard.writeText(e).then((()=>{this.handleClipboardSuccess(n.CopyLinkMethod.CLIPBOARD_API)}),(()=>{this.handleClipboardFailureNewAPI()}))}else this.handleClipboardFailureNewAPI()},this.handleClipboardFailureNewAPI=()=>{this.exceptionType=n.CopyLinkException.FAILED_COPY_TO_CLIPBOARD,this.failToFetchCopyLinkHelper()},this.logPreviewsLoggedOutCommentingExposure=()=>{this.props.loggedOutCommentingVariant&&n.logExposure({feature:"previews_logged_out_commenting",variant:this.props.loggedOutCommentingVariant})},this.getLinkActionTTI=e=>Date.now()-e,this.onClose=()=>{this.props.setIsCreatingSharedLink(!1,this.fileIdOrPath),this.props.userActionSource===n.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!1}),this.props.onActionFlowComplete&&this.props.onActionFlowComplete(),this.setState({isOpen:!1})},this.focusOnInput=()=>{this.inputRef.current&&this.inputRef.current.select()},this.openShareModalSettings=e=>{const t={origin:e,initialScreen:"settings",initialTab:"editor"===this.getAccessLevel()?"edit_link_settings":"view_link_settings"};if(this.props.file)n.asyncShowShareModal(this.props.user,this.props.file,t);else if(this.props.fileUpload)n.asyncShowShareModal(this.props.user,{fqPath:this.props.fileUpload.dest+"/"+this.props.fileUpload.name,isFolder:!1},t);else{if(!this.props.browseFile)return void n.sharingNotificationError((i=r.intl,i.formatMessage({id:"+iNJRS",defaultMessage:"There was a problem completing this request."})));n.asyncShowShareModal(this.props.user,this.props.browseFile,t)}var i;this.onClose()},this.inputRef=R.default.createRef(),this.state={isOpen:!0,stage:n.ModalState.PENDING},this.fileIdOrPath=this.getFileIdOrPath(),this.loggingKey=n.UUID.v4();const{actionSurface:t,actionElement:i,origin:s,contentAction:o}=this.getOriginAndAction();this.actionSurface=t,this.actionElement=i,this.contentAction=o,this.origin=s,this.requestedAccessLevel="default",this.screen=this.getScreen(),this.senderTrackey=n.vendSenderTrackey()}componentDidMount(){n.logPAPCreateSharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey}),n.logPAPCopySharedLinkEvent({eventState:"start",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen}),this.props.isTriggeredAsShareModal&&this.logPAPAsShareModal({loggingAction:"start"}),this.createSharedLink()}componentDidUpdate(e,t){!this.props.isTriggeredAsShareModal||t.stage!==n.ModalState.PENDING||this.state.stage!==n.ModalState.RESULT&&this.state.stage!==n.ModalState.COPY||this.logPAPAsShareModal({loggingAction:"end",eventState:"success"}),this.props.isTriggeredAsShareModal&&t.stage!==n.ModalState.ERROR&&this.state.stage===n.ModalState.ERROR&&this.logPAPAsShareModal({loggingAction:"end",eventState:"failed"})}createSharedLink(){this.props.setIsCreatingSharedLink(!0,this.fileIdOrPath),this.props.userActionSource===n.ActionSourceValue.BUTTON&&this.props.onHoverLocked&&this.props.onHoverLocked({isOpen:!0}),this.startCreateLinkTime=Date.now();const e=n.getApiClient(this.props.user),t=this.requestedAccessLevel;e.createSharedLinkNonAlpha({fileIdOrPath:this.fileIdOrPath,settings:{access:t}}).then((e=>{this.startCopyLinkTime=Date.now(),this.succeedToFetchLinkHelper(e,!0),"folder"!==e.file_type&&this.logPreviewsLoggedOutCommentingExposure(),this.logEvent(n.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:this.getAccessLevel(),commentId:this.props.commentId})})).catch((e=>{this.startCopyLinkTime=Date.now(),e.error[".tag"]===n.CopyLinkException.SHARED_LINK_ALREADY_EXISTS?this.succeedToFetchLinkHelper(e.error.shared_link_already_exists.metadata,!1,e):e.error[".tag"]===n.CopyLinkException.ACCESS_DENIED?(this.exceptionType=n.CopyLinkException.ACCESS_DENIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===n.CopyLinkException.SETTINGS_ERROR&&e.error.settings_error[".tag"]===n.CopyLinkException.NOT_AUTHORIZED?(this.exceptionType=n.CopyLinkException.NOT_AUTHORIZED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===n.CopyLinkException.PATH&&e.error.path[".tag"]===n.CopyLinkException.NOT_FOUND?(this.exceptionType=n.CopyLinkException.NOT_FOUND,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===n.CopyLinkException.EMAIL_NOT_VERIFIED?(this.exceptionType=n.CopyLinkException.EMAIL_NOT_VERIFIED,this.failToFetchCopyLinkHelper(e)):e.error[".tag"]===n.CopyLinkException.BANNED_MEMBER?(this.exceptionType=n.CopyLinkException.BANNED_MEMBER,this.userMessage=e.message,this.failToFetchCopyLinkHelper(e)):(this.exceptionType=e.error[".tag"]?e.error[".tag"]:n.CopyLinkException.UNDEFINED_ERROR,this.failToFetchCopyLinkHelper(e)),this.logEvent(n.TiburonEventName.AttemptCreateSharedLinkWithSettings,{access:t,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId})}))}succeedToFetchLinkHelper(e,t,i){this.sharedLink=e,this.isLinkNewlyCreated=t,this.httpCode=t?200:i&&i.raw&&i.raw.status,this.logEvent(n.TiburonEventName.SucceedCreateSharedLinkWithSettings,{created_new_link:t,http_status_code:this.httpCode,response_status:"success",is_alpha:!1,access:this.getAccessLevel(),timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),n.logPAPCreateSharedLinkEvent({eventState:"success",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,httpCode:this.httpCode,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey}),t&&this.props.file&&!this.props.isSearchMode&&a.getStoreForSharedWith().dispatch(a.sharedLinkDataOutOfDate(this.props.file.fq_path)),n.isBrowserCopyEnabled()?this.handleCopyLinkToClipboard():this.props.clipboardWriter?this.handleClipboardWriterCopyLinkToClipboard():(this.setState({stage:n.ModalState.COPY}),n.logPAPCopySharedLinkEvent({eventState:"canceled",actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),metadata:e,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})),n.publishEvent(n.CampaignEvents.FILE_SHARE_SUCCESS,{context:{file_name:this.props.file?n.getFilename(this.props.file):"",file_extension:this.props.file?n.getExtension(this.props.file):"",file_path:this.props.file?this.props.file.fq_path:""}})}failToFetchCopyLinkHelper(e){e&&(this.logEvent(n.TiburonEventName.FailCreateSharedLinkWithSettings,{error_message:this.exceptionType,http_status_code:e.raw&&e.raw.status,is_alpha:!1,timing:this.getLinkActionTTI(this.startCreateLinkTime),commentId:this.props.commentId}),n.logPAPCreateSharedLinkEvent({eventState:n.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey})),this.setState({stage:n.ModalState.ERROR}),this.logEvent(n.TiburonEventName.CopySharedLinkFailure,{error:this.exceptionType,timing:this.getLinkActionTTI(this.startCopyLinkTime),commentId:this.props.commentId}),n.logPAPCopySharedLinkEvent({eventState:n.getErrorState(this.exceptionType),actionSurface:this.actionSurface,actionElement:this.actionElement,contentAction:this.contentAction,requestedAccessLevel:this.requestedAccessLevel,fileIdOrPath:this.fileIdOrPath,content:this.getPAPLoggerContent(),httpCode:e&&e.raw&&e.raw.status,exception:this.exceptionType,metadata:this.sharedLink?this.sharedLink:void 0,isSm24:this.props.isFromShareMe24Modal,loggingKey:this.loggingKey,commentId:this.props.commentId,screen:this.screen})}getFileIdOrPath(){var e,t;return(null===(e=this.props.file)||void 0===e?void 0:e.file_id)||(null===(t=this.props.file)||void 0===t?void 0:t.fq_path)||this.props.filePath}getAccessLevel(){const e=this.sharedLink?this.sharedLink.link_permissions.link_access_level:void 0;let t="viewer";return e&&(t=e.hasOwnProperty(".tag")?e[".tag"]:e),t}getLinkVisibilityMapping(e){switch(e){case"public":case"password":case"no_one":return e;case"team_only":return"team";case"team_and_password":return"password";case"shared_folder_only":case"only_you":return"no_one"}}getLinkAudience(){if(!this.sharedLink)return;let e;const t=this.sharedLink.link_permissions;if(t.effective_audience)e=t.effective_audience,"object"==typeof e&&".tag"in e&&(e=e[".tag"]);else{let i;i=t.resolved_visibility,"object"==typeof i&&".tag"in i&&(i=i[".tag"]),e=this.getLinkVisibilityMapping(i)}return e}logEvent(e,t){var s,o;let a=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON;this.props.isFromShareMe24Modal?a=this.props.origin:this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.RIGHT_SIDEBAR?a=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS_BUTTON:this.props.userActionSource===n.ActionSourceValue.OVERFLOW_MENU?a=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU:this.props.userActionSource===n.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?a=n.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL:this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.PREVIEW_TITLEBAR?a=n.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR:this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.CONTENT_TILE?a=this.props.isSearchMode?n.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON:n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON:this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?a=this.props.isSearchMode?n.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE:n.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE:this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(a=n.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR);const r=i.get_browser_info();n.ShareTibEventLogger.log(this.props.user.id,e,a,{...n.buildExtraFromLinkMetadata(this.sharedLink),file_id:null===(s=this.props.file)||void 0===s?void 0:s.file_id,fq_path:(null===(o=this.props.file)||void 0===o?void 0:o.fq_path)||this.props.filePath,browser:r.browser,browser_version:r.version,...t}),e===n.TiburonEventName.CopySharedLink&&n.trackUserLeapEvent(n.SharingUserLeapEvent.SHARE_LINK_COPY_SUCCESS,a)}getOriginAndAction(){let e=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_BUTTON,t="browse_screen",i="browse_directory_row";const s=this.props.isTriggeredAsShareModal?"share":"copy_link";return this.props.isFromShareMe24Modal?(e=this.props.origin,t=this.props.actionSurface,i=this.props.actionElement):this.props.isSearchMode?(t="search",i="search_directory_row",this.props.userActionSource===n.ActionSourceValue.OVERFLOW_MENU?i="content_overflow_menu":this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.CONTENT_TILE?(e=n.SHARE_ACTION_ORIGIN_TYPE.SEARCH_CONTENT_TILE_BUTTON,i="content_tile"):this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE&&(e=n.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_SEARCH_CONTENT_TILE,t="search_quick_view",i=n.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE)):this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.RIGHT_SIDEBAR?(e=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS,i="action_bar_overflow_menu"):this.props.userActionSource===n.ActionSourceValue.OVERFLOW_MENU?this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.FOLDER_SETTINGS_MENU?(e=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,i="context_menu"):(e=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ROW_OVERFLOW_MENU,i="content_overflow_menu"):this.props.userActionSource===n.ActionSourceValue.COPY_LINK_FROM_UPLOAD_MODAL?(e=n.SHARE_ACTION_ORIGIN_TYPE.COPY_LINK_FROM_UPLOAD_MODAL,i="upload_modal"):this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.PREVIEW_TITLEBAR?(e=n.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE_TITLEBAR,t="previews",i="preview_titlebar"):this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.CONTENT_TILE?(e=n.SHARE_ACTION_ORIGIN_TYPE.BROWSE_CONTENT_TILE_BUTTON,t="browse_screen",i="content_tile"):this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE?(e=n.SHARE_ACTION_ORIGIN_TYPE.QUICK_VIEW_BROWSE_CONTENT_TILE,t="browse_quick_view",i=n.ActionSurfaceLogValue.QUICK_VIEW_FOLDER_CONTENT_TILE):this.props.userActionSurfaceLogValue===n.ActionSurfaceLogValue.COMMENTS_SIDEBAR&&(e=n.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_COMMENTS_SIDEBAR,t="previews",i="comment"),{origin:e,actionSurface:t,actionElement:i,contentAction:s}}render(){var e;if(!this.state.isOpen)return null;this.appendSenderTrackeyToLink(),this.appendCommentIdToLink();const t=(null===(e=this.sharedLink)||void 0===e?void 0:e.link_permissions.allow_logged_out_commenting)&&"public"===this.getLinkAudience(),i=this.props.isCenteredDisplayed?{isCenteredDisplayed:!0}:{isCenteredDisplayed:!1,anchorRef:this.props.anchorRef,yOffsetDistance:this.props.yOffsetDistance,placement:this.props.placement};switch(this.state.stage){case n.ModalState.PENDING:return R.default.createElement(G,{stage:n.ModalStage.PENDING,closeButtonHandler:this.onClose,zIndexOverride:this.props.zIndexOverride,isLinkToComment:!!this.props.commentId,...i});case n.ModalState.COPY:return R.default.createElement(G,{stage:n.ModalStage.COPY,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!1,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,isLoggedOutCommentingEnabled:t,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,isTriggeredAsShareModal:this.props.isTriggeredAsShareModal,...i});case n.ModalState.ERROR:if(this.exceptionType!==n.CopyLinkException.FAILED_COPY_TO_CLIPBOARD){if(this.exceptionType===n.CopyLinkException.BANNED_MEMBER&&this.userMessage)return this.onClose(),n.failBannerWithHelpCenter(this.userMessage,n.ABUSE_HELP_ARTICLE_LINK),null;const e=((e,t)=>{switch(t){case n.CopyLinkException.ACCESS_DENIED:case n.CopyLinkException.NOT_AUTHORIZED:return e.formatMessage({id:"kyPbwf",defaultMessage:"You don’t have permission to create a link to this content"});case n.CopyLinkException.NOT_FOUND:return e.formatMessage({id:"Sh48Q6",defaultMessage:"We can’t find this file anymore. Try checking activity or folder history to see what happened."});case n.CopyLinkException.EMAIL_NOT_VERIFIED:return e.formatMessage({id:"JaPuez",defaultMessage:"You can’t share until you verify your email address"});default:return e.formatMessage({id:"Xfj5ph",defaultMessage:"Try reloading the page or asking us for <l>help</l>"},{l:e=>R.default.createElement(n.Link,{href:"https://help.dropbox.com",target:"_blank",rel:"noopener noreferrer"},e)})}})(r.intl,this.exceptionType);return R.default.createElement(G,{stage:n.ModalStage.ERROR_SERVER,closeButtonHandler:this.onClose,errorMessage:e,zIndexOverride:this.props.zIndexOverride,isLinkToComment:!!this.props.commentId,...i})}return R.default.createElement(G,{stage:n.ModalStage.ERROR_CLIENT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,isLoggedOutCommentingEnabled:t,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,...i});case n.ModalState.RESULT:return R.default.createElement(G,{stage:n.ModalStage.RESULT,linkAccessLevel:this.getAccessLevel(),actionHandler:this.handleCopyLinkToClipboard,closeButtonHandler:this.onClose,sharedLink:this.sharedLink,focusOnInput:this.focusOnInput,inputRef:this.inputRef,shouldFocusOnLink:!0,onCopyToClipboard:this.handleOnCopyToClipboard,zIndexOverride:this.props.zIndexOverride,fileInfo:this.props.file,fileUploadInfo:this.props.fileUpload,browseFileInfo:this.props.browseFile,linkAudience:this.getLinkAudience(),user:this.props.user,isLoggedOutCommentingEnabled:t,openShareModalSettings:this.openShareModalSettings,isLinkToComment:!!this.props.commentId,isTriggeredAsShareModal:this.props.isTriggeredAsShareModal,...i})}}}K.displayName="CopyLinkMiniModalComponent";const z=e=>{const{variant:t}=n.useExperimentVariant("previews_logged_out_commenting");return R.default.createElement(K,{...e,loggedOutCommentingVariant:t})};z.displayName="CopyLinkMiniModalWithHooks";const j=e=>R.default.createElement(s.QueryClientProvider,{client:s.queryClient},R.default.createElement(o.ShareBlockingWrapper,{action:"share_link",onStatusChange:e=>{}},R.default.createElement(z,{...e})));j.displayName="CopyLinkMiniModalWithProviders";const Q=e=>R.default.createElement(s.QueryClientProvider,{client:s.queryClient},R.default.createElement(z,{...e}));Q.displayName="CopyLinkMiniModalWithProvidersWithoutLockedStateModal";const $=n.requireCssWithComponent(j,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css","/static/metaserver/static/css/dig-components/index.web-vflwzEcep.css"]);$.show=(e,t)=>{n.Modal.showInstance(R.default.createElement($,{...e}),!0,t)};const X=n.requireCssWithComponent(Q,["/static/metaserver/static/css/sharing/copy_link_mini_modal-vflI8kxTj.css","/static/metaserver/static/css/dig-components/index.web-vflwzEcep.css"]);X.show=(e,t)=>{n.Modal.showInstance(R.default.createElement(X,{...e}),!0,t)},e.CopyLinkMiniModal=$,e.CopyLinkMiniModalComponent=K,e.CopyLinkMiniModalWithoutLockedStateModal=X}));
//# sourceMappingURL=c_views_copy_link_mini_modal_copy_link_mini_modal.after-display.js-vflgtlmHW.map

//# debugId=02c2f460-9c2b-3fb5-90ef-60381da3e43b