!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8e786046-e858-36e5-b251-89dcbe05d31e")}catch(e){}}();
define(["exports","./e_file_viewer_static_scl_page_file","./c_browse_shared_with_api","./c_sharing_avatar_info","./e_data_modules_stormcrow"],(function(e,a,t,r,s){"use strict";const i={sharedFolderDataByTargetNamespaceId:{},hasSharedDataLoadedByParentPath:{},sharedLinkExistsByFileIdOrPath:{},sharedFileDataByFileId:{},integrationData:void 0};function n(e,a){return["share_ajax:shared_with",e,a.toString()]}const d=e=>a.user(e);let o=null;const h=({parentPath:e})=>(t,r)=>{const s=r(),i=d(s),n=a.mountPoints(s),o={};n&&n.forEach(((e,t)=>o[t]={memberCount:1,joinedMembers:[{...i,access_type:"owner",user_id:i.id,photo_url:i.photo_url,initials:a.getInitials(i.display_name)}]})),t(S.setNamespaceSharedWithData({parentPath:e,sharedFolderData:o}))},l=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedWithData`,(async({parentPath:e},{getState:a})=>{const r=a(),i=d(r);return await s.queryClient.fetchQuery(n(e,5),(async()=>await t.getSharedWithFolderData(i,e,5).then((a=>{const t=(e=>{const a={};for(const t of e)a[t.ns_id]={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members,audienceDescription:t.audience_description,memberCount:t.num_users_and_invites,accessTextData:{total_groups_and_users:t.total_groups_and_users,total_unique_inherited_members:t.total_unique_inherited_members,total_unique_users:t.total_unique_users,users_outside_team:t.users_outside_team,is_confidential:t.is_confidential,isParentTmr:t.is_parent_tmr,is_parent_tsd:t.is_parent_tsd,is_parent_namespace:t.is_parent_namespace,has_team_group:t.has_team_group,has_group:t.has_group}};return a})(a);return{sharedFolderData:t,parentPath:e}})).finally((()=>o=null))))})),_=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedFileDataForFiles`,(async(e,{getState:a,dispatch:s,rejectWithValue:i})=>{const n=a(),o=d(n);if(!o.is_email_verified)return i("User's email is not verified.");const h=e.slice(0,100),l=e.slice(100);return await t.listMembersBatch(h,5,o).then((e=>{const a={};return e.forEach(((e,t)=>{a[t]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(r.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(r.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(r.apiUserMemberToAvatarInfo).toArray()}})),(null==l?void 0:l.length)&&s(_(l)),{sharedFileData:a}}))})),u=a.createAsyncThunk(`${a.BROWSE_SHARED_WITH_NAMESPACE_KEY}/fetchSharedLinkExists`,(async(e,{getState:r})=>{const s=r(),i=a.getBrowseState(s).user;if(i)return await t.getSharedLinkExistsForFileIdOrPath(e,i).then((a=>({fileIdOrPath:e,sharedLinkExists:(null==a?void 0:a.length)>0})))})),c=a.createSlice({name:a.BROWSE_SHARED_WITH_NAMESPACE_KEY,initialState:i,reducers:{clear:(e,a)=>i,clearSharedFileDataByFileId:(e,a)=>{e.sharedFileDataByFileId={}},clearSharedLinkExistsCache:(e,a)=>{e.sharedLinkExistsByFileIdOrPath={}},setHasSharedDataLoaded:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=t.isLoaded},setNamespaceSharedWithData:(e,a)=>{const{payload:t}=a;e.hasSharedDataLoadedByParentPath[t.parentPath]=!0,e.sharedFolderDataByTargetNamespaceId=t.sharedFolderData}},extraReducers:e=>{e.addCase(l.fulfilled,((e,{payload:a})=>{const t={...e.hasSharedDataLoadedByParentPath};return(null==a?void 0:a.parentPath)?(t[a.parentPath]=!0,{...e,hasSharedDataLoadedByParentPath:t,sharedFolderDataByTargetNamespaceId:a.sharedFolderData}):e})).addCase(_.fulfilled,((e,{payload:a})=>({...e,sharedFileDataByFileId:{...e.sharedFileDataByFileId,...a.sharedFileData}}))).addCase(u.fulfilled,((e,a)=>{a.payload&&(e.sharedLinkExistsByFileIdOrPath[a.payload.fileIdOrPath]=a.payload.sharedLinkExists)}))}}),{reducer:p}=c,S=c.actions;let m;e.getStoreForSharedWith=()=>(m||(m=a.getStoreAndRegisterReducers({[a.BROWSE_SHARED_WITH_NAMESPACE_KEY]:p})),a.getStoreForBrowse(),m),e.initialSharedWithState=i,e.sharedFileDataOutOfDate=e=>a=>{a(_(e))},e.sharedFolderDataOutOfDate=e=>(t,r)=>{if(!e){const t=r();e=a.path(t)}s.queryClient.invalidateQueries(n(e,5)),t((({parentPath:e,abortCurrentRequest:t=!1})=>(r,s)=>{const i=s();t&&o&&o.abort(),a.isInsideBackupFolder(i)?r(h({parentPath:e})):r(l({parentPath:e}))})({parentPath:e}))},e.sharedLinkDataOutOfDate=e=>a=>{e&&a(u(e))}}));
//# sourceMappingURL=c_shared_with_redux_store.js-vfl716oga.map

//# debugId=8e786046-e858-36e5-b251-89dcbe05d31e